{% extends "base.html" %}
{% block title %}Avaliar Pedido{% endblock %}

{% block extra_styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='avaliar_pedido.css') }}" />
<style>
    /* Estilo inline para garantir visualização correta das estrelas */
    .star-icon { cursor: pointer; transition: color 0.2s; }
    .star-icon:hover { transform: scale(1.2); }
</style>
{% endblock %}

{% block content %}

<section class="container py-4">
    <div class="row justify-content-center">
        <div class="col-lg-6 col-md-8">
            
            <div class="mb-3">
                <a href="{{ url_for('pedidos.rastreio_publico', token=pedido.token_rastreio) }}" class="text-decoration-none text-secondary d-flex align-items-center gap-2">
                    <i class="bi bi-arrow-left"></i> Voltar
                </a>
            </div>

            <div class="card border-0 shadow-sm text-center">
                
                <div class="card-header bg-white border-bottom-0 pt-5 pb-0">
                    <div class="mb-3">
                        <span class="d-inline-flex align-items-center justify-content-center bg-warning bg-opacity-10 text-warning rounded-circle" style="width: 80px; height: 80px;">
                            <i class="bi bi-star-fill fs-1"></i>
                        </span>
                    </div>
                    <h2 class="h3 fw-bold text-primary">Como foi o pedido?</h2>
                    <p class="text-muted">Avalie sua experiência com o pedido <span class="fw-bold">#{{ pedido.numero_pedido }}</span></p>
                </div>

                <div class="card-body p-4 pt-2">
                    <form action="{{ url_for('pedidos.avaliar_pedido', token=pedido.token_rastreio) }}" method="POST">
                        
                        <input type="hidden" name="nota" id="notaInput" value="5">

                        <div class="mb-4">
                            <div class="star-rating d-flex justify-content-center gap-2" id="starContainer">
                                <i class="bi bi-star-fill fs-1 text-warning star-icon" data-value="1"></i>
                                <i class="bi bi-star-fill fs-1 text-warning star-icon" data-value="2"></i>
                                <i class="bi bi-star-fill fs-1 text-warning star-icon" data-value="3"></i>
                                <i class="bi bi-star-fill fs-1 text-warning star-icon" data-value="4"></i>
                                <i class="bi bi-star-fill fs-1 text-warning star-icon" data-value="5"></i>
                            </div>
                            <div class="form-text mt-2 fw-bold text-primary" id="feedbackTexto">Excelente!</div>
                        </div>

                        <div class="mb-4 text-start">
                            <label for="comentario" class="form-label fw-semibold">Deixe um comentário (opcional)</label>
                            <textarea class="form-control bg-light" id="comentario" name="comentario" rows="3" placeholder="Conte-nos mais detalhes sobre o resultado..."></textarea>
                        </div>

                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary btn-lg fw-semibold shadow-sm">Enviar Avaliação</button>
                            <a href="{{ url_for('pedidos.rastreio_publico', token=pedido.token_rastreio) }}" class="btn btn-link text-secondary text-decoration-none">Pular por enquanto</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const stars = document.querySelectorAll('.star-icon');
        const notaInput = document.getElementById('notaInput');
        const feedbackTexto = document.getElementById('feedbackTexto');

        const textosFeedback = ["Muito insatisfeito", "Insatisfeito", "Razoável", "Satisfeito", "Excelente!"];

        stars.forEach(star => {
            star.addEventListener('click', function() {
                const value = parseInt(this.getAttribute('data-value'));
                notaInput.value = value;
                feedbackTexto.textContent = textosFeedback[value - 1];
                highlightStars(value);
            });
        });

        function highlightStars(count) {
            stars.forEach(star => {
                const starValue = parseInt(star.getAttribute('data-value'));
                if (starValue <= count) {
                    star.classList.remove('bi-star');
                    star.classList.add('bi-star-fill');
                } else {
                    star.classList.remove('bi-star-fill');
                    star.classList.add('bi-star');
                }
            });
        }
    });
</script>

{% endblock %}