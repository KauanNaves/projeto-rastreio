{% extends "base.html" %}
{% block title %}Avaliar Pedido{% endblock %}

{% block extra_styles %}
<link rel="stylesheet" href="../static/avaliar_pedido.css" />
{% endblock %}

{% block content %}

<section class="container py-4">
    <div class="row justify-content-center">
        <div class="col-lg-6 col-md-8">
            
            <div class="mb-3">
                <a href="{{ url_for('pedidos.detalhes_pedido') }}" class="text-decoration-none text-secondary d-flex align-items-center gap-2">
                    <i class="bi bi-arrow-left"></i> Voltar para Detalhes
                </a>
            </div>

            <div class="card border-0 shadow-sm text-center">
                
                <div class="card-header bg-white border-bottom-0 pt-5 pb-0">
                    <div class="mb-3">
                        <span class="d-inline-flex align-items-center justify-content-center bg-warning bg-opacity-10 text-warning rounded-circle" style="width: 80px; height: 80px;">
                            <i class="bi bi-star-fill fs-1"></i>
                        </span>
                    </div>
                    <h2 class="h3 fw-bold text-primary">Como foi o pedido?</h2>
                    <p class="text-muted">Avalie sua experiência com o pedido <span class="fw-bold">#123456</span></p>
                </div>

                <div class="card-body p-4 pt-2">
                    <form action="#" method="POST">
                        
                        <input type="hidden" name="nota" id="notaInput" value="0">

                        <div class="mb-4">
                            <div class="star-rating d-flex justify-content-center gap-2" id="starContainer">
                                <i class="bi bi-star fs-1 text-warning cursor-pointer star-icon" data-value="1"></i>
                                <i class="bi bi-star fs-1 text-warning cursor-pointer star-icon" data-value="2"></i>
                                <i class="bi bi-star fs-1 text-warning cursor-pointer star-icon" data-value="3"></i>
                                <i class="bi bi-star fs-1 text-warning cursor-pointer star-icon" data-value="4"></i>
                                <i class="bi bi-star fs-1 text-warning cursor-pointer star-icon" data-value="5"></i>
                            </div>
                            <div class="form-text mt-2" id="feedbackTexto">Toque nas estrelas para avaliar</div>
                        </div>

                        <div class="row g-2 mb-4 text-start bg-light p-3 rounded mx-1">
                            <p class="small fw-bold text-secondary text-uppercase mb-2">O que se destacou?</p>
                            
                            <div class="col-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="checkPrazo" name="destaques" value="prazo">
                                    <label class="form-check-label small" for="checkPrazo">Cumprimento do Prazo</label>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="checkQualidade" name="destaques" value="qualidade">
                                    <label class="form-check-label small" for="checkQualidade">Qualidade do Material</label>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="checkAtendimento" name="destaques" value="atendimento">
                                    <label class="form-check-label small" for="checkAtendimento">Atendimento</label>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="checkPreco" name="destaques" value="preco">
                                    <label class="form-check-label small" for="checkPreco">Custo-Benefício</label>
                                </div>
                            </div>
                        </div>

                        <div class="mb-4 text-start">
                            <label for="comentario" class="form-label fw-semibold">Deixe um comentário (opcional)</label>
                            <textarea class="form-control bg-light" id="comentario" name="comentario" rows="3" placeholder="Conte-nos mais detalhes sobre o resultado..."></textarea>
                        </div>

                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary btn-lg fw-semibold shadow-sm">Enviar Avaliação</button>
                            <a href="{{ url_for('pedidos.detalhes_pedido') }}" class="btn btn-link text-secondary text-decoration-none">Pular por enquanto</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const stars = document.querySelectorAll('.star-icon');
        const notaInput = document.getElementById('notaInput');
        const feedbackTexto = document.getElementById('feedbackTexto');

        const textosFeedback = [
            "Muito insatisfeito", 
            "Insatisfeito", 
            "Razoável", 
            "Satisfeito", 
            "Excelente!"
        ];

        stars.forEach(star => {
            // Hover: Preenche temporariamente
            star.addEventListener('mouseover', function() {
                const value = parseInt(this.getAttribute('data-value'));
                highlightStars(value);
            });

            // Clique: Define o valor final
            star.addEventListener('click', function() {
                const value = parseInt(this.getAttribute('data-value'));
                notaInput.value = value;
                feedbackTexto.textContent = textosFeedback[value - 1];
                feedbackTexto.className = "form-text mt-2 fw-bold text-primary";
                
                // Remove classe de hover para travar a seleção visualmente
                stars.forEach(s => s.classList.add('selected'));
            });
        });

        // Mouse out do container: volta para a nota selecionada (ou 0)
        document.getElementById('starContainer').addEventListener('mouseleave', function() {
            const currentRating = parseInt(notaInput.value);
            highlightStars(currentRating);
        });

        function highlightStars(count) {
            stars.forEach(star => {
                const starValue = parseInt(star.getAttribute('data-value'));
                if (starValue <= count) {
                    star.classList.remove('bi-star');
                    star.classList.add('bi-star-fill');
                } else {
                    star.classList.remove('bi-star-fill');
                    star.classList.add('bi-star');
                }
            });
        }
    });
</script>

{% endblock %}